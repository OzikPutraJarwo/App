<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychrometric - Mollier</title>
    <link rel="icon" type="image/x-icon" href="../icon/psychrometric-chart.webp">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="../main.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../assets/xlsx-0.18.5.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Rounded" rel="stylesheet">

  </head>

  <body>

    <header>
      <div class='header wrap title-only'>
        <a href='/' class='site-back site-button'>
          <svg fill='#000000' version='1.1' xmlns='http://www.w3.org/2000/svg'
            xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 512 512' xml:space='preserve'>
            <g>
              <g>
                <g>
                  <path
                    d='M490.667,234.667H158.17l112.915-112.915c8.331-8.331,8.331-21.839,0-30.17s-21.839-8.331-30.17,0L91.582,240.915 c-0.497,0.497-0.967,1.02-1.413,1.563c-0.202,0.246-0.378,0.506-0.568,0.759c-0.228,0.304-0.463,0.601-0.674,0.917 c-0.203,0.303-0.379,0.618-0.564,0.929c-0.171,0.286-0.351,0.566-0.509,0.861c-0.169,0.317-0.313,0.643-0.465,0.966 c-0.145,0.308-0.299,0.611-0.43,0.926c-0.13,0.314-0.235,0.635-0.349,0.953c-0.122,0.338-0.251,0.672-0.356,1.018 c-0.096,0.318-0.167,0.642-0.248,0.963c-0.089,0.353-0.188,0.702-0.259,1.061c-0.074,0.372-0.117,0.747-0.171,1.122 c-0.045,0.314-0.105,0.623-0.136,0.941c-0.068,0.693-0.105,1.388-0.105,2.083c0,0.007-0.001,0.015-0.001,0.022 s0.001,0.015,0.001,0.022c0.001,0.695,0.037,1.39,0.105,2.083c0.031,0.318,0.091,0.627,0.136,0.941 c0.054,0.375,0.097,0.75,0.171,1.122c0.071,0.36,0.17,0.708,0.259,1.061c0.081,0.322,0.151,0.645,0.248,0.963 c0.105,0.346,0.234,0.68,0.356,1.018c0.114,0.318,0.219,0.639,0.349,0.953c0.131,0.316,0.284,0.618,0.43,0.926 c0.152,0.323,0.296,0.649,0.465,0.966c0.158,0.295,0.338,0.575,0.509,0.861c0.186,0.311,0.361,0.626,0.564,0.929 c0.211,0.316,0.447,0.613,0.674,0.917c0.19,0.253,0.365,0.513,0.568,0.759c0.446,0.544,0.916,1.067,1.413,1.563l149.333,149.333 c8.331,8.331,21.839,8.331,30.17,0s8.331-21.839,0-30.17L158.17,277.333h332.497c11.782,0,21.333-9.551,21.333-21.333 S502.449,234.667,490.667,234.667z' />
                  <path
                    d='M21.333,85.333C9.551,85.333,0,94.885,0,106.667v298.667c0,11.782,9.551,21.333,21.333,21.333 c11.782,0,21.333-9.551,21.333-21.333V106.667C42.667,94.885,33.115,85.333,21.333,85.333z' />
                </g>
              </g>
            </g>
          </svg>
        </a>
        <div class='site-title'>Psychrometric - Mollier</div>
      </div>
    </header>

    <main>

      <div class="main wrap">

        <div class="controls-section">
          
          <div class="controls-scroll toolbars item">

            <h3>Toolbars</h3>

            <div class="toolbar">
              <div class="toolbar-group">
                <div class="toolbar-button">
                  <button class="tool-btn active" id="btn-view" onclick="setMode('view')">
                    <span><span class="material-symbols-rounded"> explore </span> Explore</span>
                  </button>
                  <button class="tool-btn" id="btn-point" onclick="setMode('point')">
                    <span><span class="material-symbols-rounded"> pin_drop </span> Point</span>
                  </button>
                  <button class="tool-btn" id="btn-zone" onclick="setMode('zone')">
                    <span><span class="material-symbols-rounded"> add_triangle </span> Zone</span>
                  </button>
                </div>
              </div>
            </div>

            <div id="zone-controls" class="toolbar-controls" style="display: none">

              <div class="zone-tabs toolbar-tabs">
                <div class="z-tab active toolbar-tab" id="tab-manual" onclick="setZoneSubMode('manual')">Click</div>
                <!-- <div class="z-tab" id="tab-input" onclick="openManualModal('zone')">Input</div> -->
                <div class="z-tab toolbar-tab" id="tab-input" onclick="setZoneSubMode('input')">Input</div>
                <div class="z-tab toolbar-tab" id="tab-range" onclick="setZoneSubMode('range')">Range</div>
              </div>

              <div id="zone-manual-ui">
                <div class="toolbar-desc">
                  Click on the chart to define the point (minimum 3 points required).
                </div>
                <div id="zonePtCount">0 pts</div>
                <div class="toolbar-action c2">
                  <button class="tool-btn btn-primary" onclick="finishZone()">Finish Zone</button>
                  <button class="tool-btn btn-danger" onclick="cancelZone()">Cancel</button>
                </div>
              </div>

              <div id="zone-input-ui">

                <div class="toolbar-desc">
                  Define the parameters and fill in their values to determine the point (minimum 3 points required).
                </div>
                <div class="toolbar-type-input">
                  <div>
                    <label>1st Parameter</label>
                    <select id="p1Type-zone" oninput="syncToolbarInputWithFloating('zone', 'p1Type')">
                      <option value="Tdb">Dry Bulb Temp (°C)</option>
                      <option value="Twb">Wet Bulb Temp (°C)</option>
                      <option value="RH">Rel. Humidity (%)</option>
                      <option value="W">Humidity Ratio (kg/kg')</option>
                      <option value="h">Enthalpy (kJ/kg)</option>
                    </select>
                    <input type="number" id="p1Val-zone" step="0.1" placeholder="Value" oninput="syncToolbarInputWithFloating('zone', 'p1Val')">
                  </div>

                  <div>
                    <label>2nd Parameter</label>
                    <select id="p2Type-zone" oninput="syncToolbarInputWithFloating('zone', 'p2Type')">
                      <option value="RH" selected="">Rel. Humidity (%)</option>
                      <option value="Tdb">Dry Bulb Temp (°C)</option>
                      <option value="Twb">Wet Bulb Temp (°C)</option>
                      <option value="W">Humidity Ratio (kg/kg')</option>
                      <option value="h">Enthalpy (kJ/kg)</option>
                    </select>
                    <input type="number" id="p2Val-zone" step="0.1" placeholder="Value" oninput="syncToolbarInputWithFloating('zone', 'p2Val')">
                  </div>
                </div>

                <div class="toolbar-action c2">
                  <!-- <button class="tool-btn" onclick="closeModal('manualModal')">Cancel</button> -->
                  <button class="tool-btn btn-secondary" onclick="submitManualInput('zone')">Add</button>
                  <button class="tool-btn btn-primary" onclick="finishZone()">Finish Zone</button>
                </div>
              </div>

              <div id="zone-range-ui" style="display: none;">

                <div class="toolbar-desc">
                  Define the parameters and move the slider to define the zone.
                </div>

                <div class="toolbar-type-range">
                  <div>
                    <div class="title-row">
                      <label>1st Parameter:</label>
                      <input type="text" value="Dry Bulb (°C)" disabled>
                    </div>
                    <div class="range-row">
                      <label for="rangeTmin">Min</label>
                      <input type="range" class="range-slider" id="sliderTmin" min="-10" max="60" value="20"
                        oninput="syncRange('Tmin')">
                      <input type="number" class="range-val" id="rangeTmin" min="-10" max="60" value="20"
                        oninput="updateRangeZone()">
                      <label for="rangeTmax">Max</label>
                      <input type="range" class="range-slider" id="sliderTmax" min="-10" max="60" value="30"
                        oninput="syncRange('Tmax')">
                      <input type="number" class="range-val" id="rangeTmax" min="-10" max="60" value="30"
                        oninput="updateRangeZone()">
                    </div>
                  </div>
                  <div>
                    <div class="title-row">
                      <label>2nd Parameter:</label>
                      <select id="rangeParamType" onchange="setupRangeDefaults()">
                        <option value="RH">Rel. Humidity (%)</option>
                        <option value="Twb">Wet Bulb (°C)</option>
                        <option value="Tdp">Dew Point (°C)</option>
                        <option value="W">Humidity Ratio (kg/kg)</option>
                        <option value="h">Enthalpy (kJ/kg)</option>
                        <option value="v">Spec. Volume (m³/kg)</option>
                      </select>
                    </div>
                    <div class="range-row">
                      <label for="rangeP2min">Min</label>
                      <input type="range" class="range-slider" id="sliderP2min" oninput="syncRange('P2min')">
                      <input type="number" class="range-val" id="rangeP2min" step="0.1" oninput="updateRangeZone()">
                      <label for="rangeP2max">Max</label>
                      <input type="range" class="range-slider" id="sliderP2max" oninput="syncRange('P2max')">
                      <input type="number" class="range-val" id="rangeP2max" step="0.1" oninput="updateRangeZone()">
                    </div>
                  </div>
                </div>

                <div class="toolbar-action c2">
                  <button class="tool-btn btn-primary" onclick="finishZone()">Finish Zone</button>
                  <button class="tool-btn btn-danger" onclick="cancelZone()">Cancel</button>
                </div>

              </div>

            </div>

            <div id="point-controls" class="toolbar-controls" style="display: none;">

              <div class="point-tabs toolbar-tabs">
                <div class="p-tab active toolbar-tab" id="tab-manual" onclick="setPointSubMode('manual')">Click</div>
                <div class="p-tab toolbar-tab" id="tab-input" onclick="setPointSubMode('input')">Input</div>
              </div>

              <div id="point-manual-ui">
                <div class="toolbar-desc">
                  Click on the chart to define the point.
                </div>
              </div>

              <div id="point-input-ui" style="display: none;">
                <div class="toolbar-desc">
                  Define the parameters and fill in their values to determine the point.
                </div>

                <div class="toolbar-type-input">
                  <div>
                    <label>1st Parameter</label>
                    <select id="p1Type-point" oninput="syncToolbarInputWithFloating('point', 'p1Type')">
                      <option value="Tdb">Dry Bulb Temp (°C)</option>
                      <option value="Twb">Wet Bulb Temp (°C)</option>
                      <option value="RH">Rel. Humidity (%)</option>
                      <option value="W">Humidity Ratio (kg/kg')</option>
                      <option value="h">Enthalpy (kJ/kg)</option>
                    </select>
                    <input type="number" id="p1Val-point" step="0.1" placeholder="Value" oninput="syncToolbarInputWithFloating('point', 'p1Val')">
                  </div>

                  <div>
                    <label>2nd Parameter</label>
                    <select id="p2Type-point" oninput="syncToolbarInputWithFloating('point', 'p2Type')">
                      <option value="RH" selected="">Rel. Humidity (%)</option>
                      <option value="Tdb">Dry Bulb Temp (°C)</option>
                      <option value="Twb">Wet Bulb Temp (°C)</option>
                      <option value="W">Humidity Ratio (kg/kg')</option>
                      <option value="h">Enthalpy (kJ/kg)</option>
                    </select>
                    <input type="number" id="p2Val-point" step="0.1" placeholder="Value" oninput="syncToolbarInputWithFloating('point', 'p2Val')">
                  </div>
                </div>

                <div class="toolbar-action">
                  <button class="tool-btn btn-primary" onclick="submitManualInput('point')">Add</button>
                </div>
              </div>

            </div>

            <div class="marked-point">
              <div class="toolbar-head">
                <h4>Marked Points</h4>
                <span class="count-badge" id="count-points">0</span>
              </div>
              <div id="list-points"></div>
            </div>

            <div class="comfort-zone">
              <div class="toolbar-head">
                <h4>Zones</h4>
                <span class="count-badge" id="count-zones">0</span>
              </div>
              <div id="list-zones"></div>
            </div>

          </div>

          <div class="controls-scroll item">

            <h3>Chart Settings</h3>

            <div class="input-group">
              <div class="input-item">
                <label>Chart Type</label>
                <div class="toolbar-button c2 chart-type">
                  <button class="tool-btn psychrometric active" value="psychrometric"
                    onclick="changeChartType(this.value)">
                    <img src="../icon/type-psychrometric.png" alt="">
                    <span>Psychrometric</span>
                  </button>
                  <button class="tool-btn mollier" value="mollier" onclick="changeChartType(this.value)">
                    <img src="../icon/type-mollier.png" alt="">
                    <span>Mollier</span>
                  </button>
                </div>
              </div>
              <div class="input-item pressure-input">
                <label><span class="material-symbols-rounded"> public </span> Atm Pressure</label>
                <div class="pressure-input-row">
                  <input type="number" id="pressure" value="101325" oninput="drawChart()" step="100">
                  <select id="pressure-unit" onchange="updatePressureUnit()">
                    <option value="Pa">Pa</option>
                    <option value="kPa">kPa</option>
                  </select>
                </div>
              </div>
              <div class="input-item grid">
                <div class="input-item">
                  <label><span class="material-symbols-rounded"> thermometer_gain </span> Min DB Temp (°C)</label>
                  <input type="number" id="minTemp" value="-10" oninput="drawChart()">
                </div>
                <div class="input-item">
                  <label><span class="material-symbols-rounded"> thermometer_loss </span> Max DB Temp (°C)</label>
                  <input type="number" id="maxTemp" value="50" oninput="drawChart()">
                </div>
              </div>

              <div class="input-item">
                <label><span class="material-symbols-rounded"> line_axis </span> Y-axis Type</label>
                <div class="toolbar-button c2 yAxis-type">
                  <button class="tool-btn humidityRatio active" value="humidityRatio" onclick="changeYAxisType(this.value)">
                    <span>
                      <span class="material-symbols-rounded"> water_do </span>
                      <span>Humidity Ratio (kg/kg')</span>
                    </span>
                  </button>
                  <button class="tool-btn absoluteHumidity" value="absoluteHumidity" onclick="changeYAxisType(this.value)">
                    <span>
                      <span class="material-symbols-rounded"> salinity </span>
                      <span>Absolute Humidity (g/m³)</span>
                    </span>
                  </button>
                </div>
              </div>
              <div class="input-item ratio">
                <label><span class="material-symbols-rounded"> water_do </span> Max Humidity Ratio (kg/kg')</label>
                <input type="number" id="maxHum" value="0.030" step="0.001" min="0.001" oninput="syncHumidityInputs('ratio')">
              </div>
              <div class="input-item absolute none">
                <label><span class="material-symbols-rounded"> salinity </span> Max Absolute Humidity (g/m³)</label>
                <input type="number" id="maxAbsHum" value="31" step="1" oninput="syncHumidityInputs('absolute')">
              </div>

              <div class="input-item item-border advanced-settings">
                <div class="advanced-settings-header collapsed" onclick="toggleAdvancedSettings()">
                  <h4>Advanced Settings</h4>
                  <span class="material-symbols-rounded" id="advanced-settings-icon">expand_more</span>
                </div>
                <div class="setting-legend" id="setting-legend">
                  <div class="settype-checkbox">
                    <input type="checkbox" name="set-show-info-panel" id="set-show-info-panel" checked>
                    <label for="set-show-info-panel">Show Info Panel</label>
                  </div>
                  <div class="settype-checkbox">
                    <input type="checkbox" name="set-show-legend" id="set-show-legend" checked>
                    <label for="set-show-legend">Show Legend</label>
                  </div>
                  <div class="settype-checkbox child">
                    <input type="checkbox" name="set-show-rh" id="set-show-rh" checked>
                    <label for="set-show-rh">Relative Humidity</label>
                  </div>
                  <div class="settype-checkbox child">
                    <input type="checkbox" name="set-show-h" id="set-show-h" checked>
                    <label for="set-show-h">Enthalpy</label>
                  </div>
                  <div class="settype-checkbox child">
                    <input type="checkbox" name="set-show-twb" id="set-show-twb" checked>
                    <label for="set-show-twb">Wet Bulb Temperature</label>
                  </div>
                  <div class="settype-checkbox child">
                    <input type="checkbox" name="set-show-v" id="set-show-v" checked>
                    <label for="set-show-v">Specific Volume</label>
                  </div>
                  <div class="settype-checkbox child">
                    <input type="checkbox" name="set-show-sat" id="set-show-sat" checked>
                    <label for="set-show-sat">Saturation</label>
                  </div>
                  <div class="settype-comfort-zone">
                    <div class="settype-checkbox">
                      <input type="checkbox" name="set-show-comfort-zone" id="set-show-comfort-zone" onchange="toggleComfortZone()">
                      <label for="set-show-comfort-zone">Show Comfort Zone</label>
                    </div>
                    <div class="comfort-zone-options" id="comfort-zone-options" style="display: none;">
                      <div class="settype-select">
                        <label for="comfort-zone-preset">Preset:</label>
                        <select id="comfort-zone-preset" onchange="changeComfortZonePreset()">
                          <option value="ashrae-summer">ASHRAE 55 Summer</option>
                          <option value="ashrae-winter">ASHRAE 55 Winter</option>
                          <option value="en15251-category-ii">EN 15251 Cat II</option>
                          <option value="custom">Custom</option>
                        </select>
                      </div>
                      <div class="comfort-zone-custom" id="comfort-zone-custom" style="display: none;">
                        <div class="comfort-zone-inputs">
                          <div class="input-row">
                            <label for="comfort-tmin">T Min (°C):</label>
                            <input type="number" id="comfort-tmin" value="20" step="0.5" onchange="updateComfortZone()">
                          </div>
                          <div class="input-row">
                            <label for="comfort-tmax">T Max (°C):</label>
                            <input type="number" id="comfort-tmax" value="26" step="0.5" onchange="updateComfortZone()">
                          </div>
                          <div class="input-row">
                            <label for="comfort-rhmin">RH Min (%):</label>
                            <input type="number" id="comfort-rhmin" value="30" step="1" onchange="updateComfortZone()">
                          </div>
                          <div class="input-row">
                            <label for="comfort-rhmax">RH Max (%):</label>
                            <input type="number" id="comfort-rhmax" value="60" step="1" onchange="updateComfortZone()">
                          </div>
                        </div>
                      </div>
                      <div class="comfort-zone-color">
                        <label for="comfort-zone-color">Color:</label>
                        <input type="color" id="comfort-zone-color" value="#4caf50" onchange="updateComfortZone()">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>

          </div>
          
        </div>

        <div class="chart-section">
          <div id="chart-wrapper">
            <div id="chart-container"></div>
            <div id="info-panel">
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:3px 15px;" id="tooltip-grid"></div>
            </div>
          </div>
        </div>

      </div>

      <!-- Context Menu -->
      <div id="context-menu" class="context-menu" style="display:none;">
        <div id="context-menu-content"></div>
      </div>

      <!-- Floating Input Window -->
      <div id="floating-input-window" class="floating-window">
        <div class="floating-window-header">
          <span class="floating-window-title">Input Parameters</span>
          <span class="floating-window-close" onclick="closeFloatingWindow('floating-input-window')">×</span>
        </div>
        <div class="floating-window-content">
          <input type="hidden" id="floating-target">
          
          <div class="field-section">
            <label>1st Parameter:</label>
            <div class="param-row">
              <select id="floating-p1Type" oninput="syncFloatingInputWithToolbar('p1Type')">
                <option value="t">Dry Bulb Temp (°C)</option>
                <option value="twb">Wet Bulb Temp (°C)</option>
                <option value="rh">Rel. Humidity (%)</option>
                <option value="w">Humidity Ratio (kg/kg')</option>
                <option value="h">Enthalpy (kJ/kg)</option>
              </select>
              <input type="number" id="floating-p1Val" step="any" placeholder="Value" oninput="syncFloatingInputWithToolbar('p1Val')">
            </div>
          </div>
          
          <div class="field-section">
            <label>2nd Parameter:</label>
            <div class="param-row">
              <select id="floating-p2Type" oninput="syncFloatingInputWithToolbar('p2Type')">
                <option value="rh">Rel. Humidity (%)</option>
                <option value="t">Dry Bulb Temp (°C)</option>
                <option value="twb">Wet Bulb Temp (°C)</option>
                <option value="w">Humidity Ratio (kg/kg')</option>
                <option value="h">Enthalpy (kJ/kg)</option>
              </select>
              <input type="number" id="floating-p2Val" step="any" placeholder="Value" oninput="syncFloatingInputWithToolbar('p2Val')">
            </div>
          </div>
          
          <div class="field-section">
            <div class="floating-btn-group" id="floating-input-btn-group">
              <button class="floating-btn btn-primary" onclick="submitFloatingInput()">Add</button>
              <button class="floating-btn btn-success" id="floating-finish-zone-btn" onclick="finishZone(); closeFloatingWindow('floating-input-window');">Finish Zone</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Floating Edit Window -->
      <div id="floating-edit-window" class="floating-window">
        <div class="floating-window-header">
          <span class="floating-window-title" id="editModalTitle">Edit Item</span>
          <span class="floating-window-close" onclick="closeFloatingWindow('floating-edit-window')">×</span>
        </div>
        <div class="floating-window-content">
          <input type="hidden" id="editId">
          <input type="hidden" id="editType">
          
          <div class="field-section">
            <label>Name:</label>
            <input type="text" id="editName">
          </div>
          
          <div class="field-section" id="colorContainer">
            <label>Color:</label>
            <input type="color" id="editColor" class="color-picker">
          </div>
          
          <div class="field-section">
            <div class="floating-btn-group cols-2">
              <button class="floating-btn btn-primary" onclick="saveEditSettings()">Save</button>
              <button class="floating-btn btn-danger" onclick="closeFloatingWindow('floating-edit-window')">Cancel</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Floating Range Window -->
      <div id="floating-range-window" class="floating-window">
        <div class="floating-window-header">
          <span class="floating-window-title">Range Parameters</span>
          <span class="floating-window-close" onclick="closeFloatingWindow('floating-range-window')">×</span>
        </div>
        <div class="floating-window-content">
          <div class="field-section">
            <label>Tdb Min (°C):</label>
            <input type="range" id="floating-sliderTmin" min="-10" max="60" step="0.5" oninput="syncFloatingRange('Tmin')">
            <input type="number" id="floating-rangeTmin" min="-10" max="60" step="any" oninput="applyFloatingRange();">
          </div>
          
          <div class="field-section">
            <label>Tdb Max (°C):</label>
            <input type="range" id="floating-sliderTmax" min="-10" max="60" step="0.5" oninput="syncFloatingRange('Tmax')">
            <input type="number" id="floating-rangeTmax" min="-10" max="60" step="any" oninput="applyFloatingRange();">
          </div>
          
          <div class="field-section">
            <label>2nd Parameter:</label>
            <select id="floating-rangeParamType" onchange="applyFloatingRange();">
              <option value="RH">Rel. Humidity (%)</option>
              <option value="Twb">Wet Bulb (°C)</option>
              <option value="Tdp">Dew Point (°C)</option>
              <option value="W">Humidity Ratio (kg/kg)</option>
              <option value="h">Enthalpy (kJ/kg)</option>
              <option value="v">Spec. Volume (m³/kg)</option>
            </select>
          </div>
          
          <div class="field-section">
            <label>Min Value:</label>
            <input type="range" id="floating-sliderP2min" step="1" oninput="syncFloatingRange('P2min')">
            <input type="number" id="floating-rangeP2min" step="0.1" oninput="applyFloatingRange();">
          </div>
          
          <div class="field-section">
            <label>Max Value:</label>
            <input type="range" id="floating-sliderP2max" step="1" oninput="syncFloatingRange('P2max')">
            <input type="number" id="floating-rangeP2max" step="0.1" oninput="applyFloatingRange();">
          </div>
          
          <div class="field-section">
            <div class="floating-btn-group cols-2">
              <button class="floating-btn btn-success" onclick="finishZone(); closeFloatingWindow('floating-range-window');">Finish Zone</button>
              <button class="floating-btn btn-danger" onclick="cancelZone(); closeFloatingWindow('floating-range-window');">Cancel</button>
            </div>
          </div>
        </div>
      </div>

    </main>

    <script src="./script.js"></script>

  </body>

</html>